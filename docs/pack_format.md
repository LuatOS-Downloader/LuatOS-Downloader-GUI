# 芯片支持包

芯片支持包用于芯片的`日志打印`、`下载`、`文件系统与固件合并`、`安装驱动`

由于许多芯片的日志打印与下载参数完全相同，所以芯片支持包支持**嵌套依赖**，以节省开发成本与硬盘与宽带占用

## 打包形式

每个芯片支持包为zip，根目录应当为一个文件夹（不能直接zip打开就是一堆文件）  
命名规则为`包名-支持系统-版本.zip`，其中

- `包名`原则上应为全小写，比如`air101`、`uart`等，不应当包含特殊字符，可以包含下划线
- `支持系统`由两部分组成：`系统`与`架构`，二者使用下划线分隔
  - `系统`包括： `win`、`linux`、`mac`
  - `架构`包括： `x86`、`x64`、`arm`、`arm64`。其中`x86`与`arm`后续可能考虑移除
- `版本`使用四个数字与小数点分隔，如`1.0.0.0`、`1.0.0.123`

## 文件夹结构

每个芯片支持包需要经过解压，放入`LuatOS_Downloader_Data/packs/`路径中，文件夹结构如下

- packs/ : LuatOS_Downloader的芯片支持包目录
  - air101-1.2.3.4/ : 某芯片支持包解压后的文件夹+版本号
    - config.toml : 某芯片支持包的配置信息
    - logger/ : 日志打印工具路径（该文件夹可不存在）
    - downloader/ : 下载烧录工具路径（该文件夹可不存在）
    - firmware_maker/ : 文件系统与固件合并工具路径（该文件夹可不存在）
    - drivers/ : 驱动程序的路径（该文件夹可不存在）

不同芯片支持包均在同一同级目录，可以互相调用

## 配置信息

配置信息存储于`config.toml`中，文件格式如下：

```toml
[pack]
name = "包名"
version = "版本"
authors = ["aaa","bbb"]

#该包支持的系统架构
architecture = "win_x64"

#是否显示在支持的芯片列表中？
#某些单一功能的通用依赖包，不应显示在列表中
show = true

#依赖包列表
#软件会下载完所有依赖包，才会认为下载完成
[dependencies]
uart_log = "1.0.0.0" # 指定某个版本的包
uart_downloader = "*" # 任意版本的包都行，如果下载过任意版本的该包，就不会再下载
lfs_merge = "^" # 用当前最新版本的包
ch340_driver = "*"

#其他信息，给命令行参数使用
[others]
cmd_args = ["arg1","arg2"] # 如用不到，可为空数组
```

## 日志打印工具的交互逻辑

todo

## 下载烧录工具的交互逻辑

todo

## 文件系统与固件合并工具的交互逻辑

todo

## 驱动程序的交互逻辑

todo
